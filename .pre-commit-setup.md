# Pre-commit Hooks è®¾ç½®æŒ‡å—

## ğŸ“‹ ç®€ä»‹

Pre-commit hooks å¯ä»¥åœ¨æäº¤ä»£ç å‰è‡ªåŠ¨è¿è¡Œä»£ç æ£€æŸ¥ï¼Œç¡®ä¿ä»£ç è´¨é‡ï¼Œé¿å…åœ¨ CI ä¸­å‘ç°é”™è¯¯ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£… pre-commit

```bash
# ä½¿ç”¨ pip å®‰è£…
pip install pre-commit

# æˆ–ä½¿ç”¨é¡¹ç›®çš„è™šæ‹Ÿç¯å¢ƒ
.\venv\Scripts\pip install pre-commit  # Windows
source venv/bin/activate && pip install pre-commit  # Linux/Mac
```

### 2. å®‰è£… Git Hooks

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
pre-commit install

# è¿™ä¼šåˆ›å»º .git/hooks/pre-commit æ–‡ä»¶
```

### 3. æµ‹è¯•è¿è¡Œ

```bash
# æ‰‹åŠ¨è¿è¡Œæ‰€æœ‰ hooksï¼ˆæµ‹è¯•ï¼‰
pre-commit run --all-files

# åªè¿è¡Œç‰¹å®š hook
pre-commit run flake8 --all-files
pre-commit run black --all-files
```

## ğŸ“ ä½¿ç”¨æ–¹å¼

### æ­£å¸¸æäº¤

```bash
git add .
git commit -m "your message"
# hooks ä¼šè‡ªåŠ¨è¿è¡Œï¼Œå¦‚æœæœ‰é”™è¯¯ä¼šé˜»æ­¢æäº¤
```

### è·³è¿‡ hooksï¼ˆç´§æ€¥æƒ…å†µï¼Œä¸æ¨èï¼‰

```bash
# è·³è¿‡æ‰€æœ‰ hooks
git commit --no-verify

# è·³è¿‡ç‰¹å®š hook
SKIP=flake8 git commit
```

## ğŸ”§ é…ç½®è¯´æ˜

å½“å‰é…ç½®åŒ…å«ä»¥ä¸‹æ£€æŸ¥ï¼š

1. **åŸºç¡€æ–‡ä»¶æ£€æŸ¥**
   - åˆ é™¤è¡Œå°¾ç©ºæ ¼
   - ç¡®ä¿æ–‡ä»¶ä»¥æ¢è¡Œç¬¦ç»“å°¾
   - æ£€æŸ¥ YAML/JSON/TOML è¯­æ³•
   - æ£€æŸ¥å¤§æ–‡ä»¶
   - æ£€æŸ¥åˆå¹¶å†²çªæ ‡è®°

2. **Python ä»£ç æ ¼å¼åŒ–**
   - Blackï¼šè‡ªåŠ¨æ ¼å¼åŒ–ä»£ç ï¼ˆè¡Œé•¿åº¦ 120ï¼‰
   - isortï¼šè‡ªåŠ¨æ’åºå¯¼å…¥ï¼ˆä¸ Black å…¼å®¹ï¼‰

3. **é™æ€åˆ†æ**
   - Flake8ï¼šæ£€æŸ¥ä¸¥é‡é”™è¯¯ï¼ˆE9, F63, F7, F82ï¼‰
     - E9: è¿è¡Œæ—¶é”™è¯¯
     - F63: æ— æ•ˆçš„ print è¯­æ³•
     - F7: è¯­æ³•é”™è¯¯
     - F82: æœªå®šä¹‰åç§°

## âš™ï¸ ä¸ CI ä¿æŒä¸€è‡´

Pre-commit hooks çš„æ£€æŸ¥ä¸ CI workflow ä¿æŒä¸€è‡´ï¼š

- **CI æ£€æŸ¥**: `flake8 . --count --select=E9,F63,F7,F82`
- **Pre-commit**: ä½¿ç”¨ç›¸åŒçš„ `--select=E9,F63,F7,F82` å‚æ•°

è¿™æ ·å¯ä»¥ç¡®ä¿æœ¬åœ°æ£€æŸ¥é€šè¿‡åï¼ŒCI ä¹Ÿèƒ½é€šè¿‡ã€‚

## ğŸ”„ æ›´æ–° hooks

```bash
# æ›´æ–°æ‰€æœ‰ hooks åˆ°æœ€æ–°ç‰ˆæœ¬
pre-commit autoupdate

# æ›´æ–°ç‰¹å®š repo
pre-commit autoupdate --repo https://github.com/psf/black
```

## ğŸ› å¸¸è§é—®é¢˜

### 1. hooks è¿è¡Œå¤ªæ…¢ï¼Ÿ

å¯ä»¥è·³è¿‡æ…¢é€Ÿæ£€æŸ¥ï¼ˆå¦‚ mypyï¼‰ï¼š
```yaml
- id: mypy
  stages: [manual]  # åªåœ¨æ‰‹åŠ¨è¿è¡Œæ—¶æ‰§è¡Œ
```

### 2. æŸäº›æ–‡ä»¶ä¸æƒ³æ£€æŸ¥ï¼Ÿ

åœ¨ `.pre-commit-config.yaml` ä¸­æ·»åŠ  `exclude`ï¼š
```yaml
- id: black
  exclude: ^(venv/|\.venv/|build/|dist/)
```

### 3. å›¢é˜Ÿåä½œ

ç¡®ä¿å›¢é˜Ÿæˆå‘˜éƒ½å®‰è£…äº† pre-commitï¼š
```bash
# åœ¨ README æˆ–å¼€å‘æ–‡æ¡£ä¸­è¯´æ˜
pip install pre-commit
pre-commit install
```

## ğŸ“š å‚è€ƒèµ„æº

- [Pre-commit å®˜æ–¹æ–‡æ¡£](https://pre-commit.com)
- [Flake8 é”™è¯¯ä»£ç ](https://www.flake8rules.com)
- [Black é…ç½®](https://black.readthedocs.io)
- [isort é…ç½®](https://pycqa.github.io/isort)
